{
    "id": 21328172,
    "description": "Monitors line port health including optical power, status, and coherent DSP metrics (OSNR, Q-Factor, BER)",
    "group": "SNMP",
    "appliesTo": "hasCategory(\"InfineraGroove\")",
    "technology": "Line ports only (portType=2). ochOs table for coherent DSP metrics. Post-FEC BER from PM table.",
    "tags": "dsp,coherent,infinera,optical",
    "accessGroupIds": [
        1
    ],
    "accessGroups": [
        {
            "id": 1,
            "name": "Default Access Group",
            "createdOn": 1710215006000,
            "updatedOn": 1710215006000,
            "createdBy": "auto",
            "description": "A default access group",
            "tenantId": null
        }
    ],
    "checksum": "b49b40756cf8801c5f1fa8cb82388df8",
    "lineageId": "bM-hbaxzSzm0y9ljmmvm1w",
    "installationMetadata": null,
    "name": "Infinera_Line_Port_Health",
    "displayName": "Line Port Health",
    "version": 1765427204,
    "auditVersion": 0,
    "payloadVersion": 0,
    "hasMultiInstances": true,
    "useWildValueAsUUID": false,
    "collectInterval": 120,
    "collectMethod": "script",
    "collectorAttribute": {
        "name": "script",
        "linuxCmdline": "",
        "linuxScript": "",
        "groovyScript": "/*\n * Infinera Groove Line Port Health - Collection Script\n *\n * Collects physical port metrics + coherent DSP metrics (OSNR, Q-Factor, BER)\n */\n\nimport com.santaba.agent.groovyapi.snmp.Snmp\n\ndef host = hostProps.get(\"system.hostname\")\ndef wildvalue = instanceProps.get(\"wildvalue\")\n\n// Port table base OID\ndef portBase = \"1.3.6.1.4.1.42229.1.2.3.6.1.1\"\n\n// ochOs table base OID (coherent DSP)\ndef ochOsBase = \"1.3.6.1.4.1.42229.1.2.4.1.19.1.1\"\n\n// Post-FEC BER table base OID\ndef postFecBase = \"1.3.6.1.4.1.42229.1.2.13.2.1.1\"\n\n// Physical port OIDs\ndef rxPowerOid = \"${portBase}.4.${wildvalue}\"\ndef txPowerOid = \"${portBase}.5.${wildvalue}\"\ndef adminStatusOid = \"${portBase}.19.${wildvalue}\"\ndef operStatusOid = \"${portBase}.20.${wildvalue}\"\n\n// DSP metrics OIDs\ndef osnrOid = \"${ochOsBase}.24.${wildvalue}\"\ndef qFactorOid = \"${ochOsBase}.25.${wildvalue}\"\ndef preFecBerOid = \"${ochOsBase}.26.${wildvalue}\"\ndef postFecBerOid = \"${postFecBase}.1.${wildvalue}.0\"\n\n// Initialize all values\ndef rxPower = \"NaN\"\ndef txPower = \"NaN\"\ndef adminStatus = \"NaN\"\ndef operStatus = \"NaN\"\ndef osnr = \"NaN\"\ndef qFactor = \"NaN\"\ndef preFecBer = \"NaN\"\ndef postFecBer = \"NaN\"\n\n// Collect physical port metrics\ntry {\n    def rxResult = Snmp.get(host, rxPowerOid)\n    if (rxResult != null && rxResult != \"\") {\n        rxPower = rxResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def txResult = Snmp.get(host, txPowerOid)\n    if (txResult != null && txResult != \"\") {\n        txPower = txResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def adminResult = Snmp.get(host, adminStatusOid)\n    if (adminResult != null && adminResult != \"\") {\n        adminStatus = adminResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def operResult = Snmp.get(host, operStatusOid)\n    if (operResult != null && operResult != \"\") {\n        operStatus = operResult.toString()\n    }\n} catch (Exception e) {}\n\n// Collect DSP metrics (may not exist for all ports)\ntry {\n    def osnrResult = Snmp.get(host, osnrOid)\n    if (osnrResult != null && osnrResult != \"\") {\n        osnr = osnrResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def qResult = Snmp.get(host, qFactorOid)\n    if (qResult != null && qResult != \"\") {\n        qFactor = qResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def preFecResult = Snmp.get(host, preFecBerOid)\n    if (preFecResult != null && preFecResult != \"\") {\n        preFecBer = preFecResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def postFecResult = Snmp.get(host, postFecBerOid)\n    if (postFecResult != null && postFecResult != \"\") {\n        postFecBer = postFecResult.toString()\n    }\n} catch (Exception e) {}\n\n// Output all metrics\nprintln \"RxOpticalPower=${rxPower}\"\nprintln \"TxOpticalPower=${txPower}\"\nprintln \"AdminStatus=${adminStatus}\"\nprintln \"OperStatus=${operStatus}\"\nprintln \"OSNR=${osnr}\"\nprintln \"QFactor=${qFactor}\"\nprintln \"PreFecBer=${preFecBer}\"\nprintln \"PostFecBer=${postFecBer}\"\n\nreturn 0",
        "scriptType": "embed",
        "windowsCmdline": "",
        "windowsScript": "",
        "properties": "",
        "manualConnections": ""
    },
    "enableAutoDiscovery": true,
    "autoDiscoveryConfig": {
        "persistentInstance": false,
        "disableInstance": false,
        "deleteInactiveInstance": true,
        "showDeletedInstanceDays": 0,
        "instanceAutoGroupMethod": "none",
        "instanceAutoGroupMethodParams": "",
        "scheduleInterval": 15,
        "method": {
            "name": "ad_script",
            "type": "embeded",
            "winScript": null,
            "winCmdline": null,
            "linuxCmdline": null,
            "linuxScript": null,
            "groovyScript": "/*\n * Infinera Groove Line Port Health - Active Discovery Script\n *\n * Discovers LINE ports only (portType=2) for coherent DSP monitoring\n */\n\nimport com.santaba.agent.groovyapi.snmp.Snmp\n\ndef host = hostProps.get(\"system.hostname\")\n\n// Port table OIDs\ndef portNameOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.16\"\ndef portTypeOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.17\"\ndef portModeOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.18\"\ndef portServiceLabelOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.23\"\n\n// Port mode to speed (bps) mapping\ndef portModeSpeedMap = [\n    0: 0,\n    5: 100000000000,\n    6: 300000000000,\n    7: 200000000000,\n    10: 112000000000\n]\n\ndef portModeNameMap = [\n    0: \"N/A\",\n    5: \"100G-QPSK\",\n    6: \"300G-8QAM\",\n    7: \"200G-16QAM\",\n    10: \"OTU4\"\n]\n\ndef portNameData, portTypeData, portModeData, portServiceLabelData\n\ntry {\n    portNameData = Snmp.walkAsMap(host, portNameOid, null)\n    portTypeData = Snmp.walkAsMap(host, portTypeOid, null)\n    portModeData = Snmp.walkAsMap(host, portModeOid, null)\n    portServiceLabelData = Snmp.walkAsMap(host, portServiceLabelOid, null)\n} catch (Exception e) {\n    println \"SNMP walk failed: ${e.message}\"\n    return 1\n}\n\nif (!portNameData || portNameData.isEmpty()) {\n    return 0\n}\n\nportNameData.each { index, portName ->\n    def parts = index.split(\"\\\\.\")\n    if (parts.size() < 4) return\n\n    def shelf = parts[0]\n    def slot = parts[1]\n    def subslot = parts[2]\n    def port = parts[3]\n\n    if (shelf == \"99\" || slot == \"99\") return\n\n    def portTypeCode = portTypeData.get(index)?.toString() ?: \"\"\n    try {\n        if (portTypeCode.toInteger() != 2) return\n    } catch (Exception e) {\n        return\n    }\n\n    def portModeCode = portModeData.get(index)?.toString() ?: \"0\"\n    def portModeInt = 0\n    try {\n        portModeInt = portModeCode.toInteger()\n    } catch (Exception e) {}\n\n    def speedBps = portModeSpeedMap.get(portModeInt) ?: 0\n    def modeName = portModeNameMap.get(portModeInt) ?: \"Unknown\"\n\n    def serviceLabel = portServiceLabelData.get(index)?.toString()?.trim() ?: \"\"\n\n    def portPath\n    if (subslot == \"0\") {\n        portPath = \"${shelf}/${slot}/${port}\"\n    } else {\n        portPath = \"${shelf}/${slot}.${subslot}/${port}\"\n    }\n\n    def displayName = \"${portPath} [line]\"\n    def description = portName?.toString()?.trim() ?: \"\"\n\n    def props = \"auto.port.speed=${speedBps}\"\n    props += \"&auto.port.mode=${modeName}\"\n    props += \"&auto.port.type=line\"\n    if (serviceLabel) {\n        props += \"&auto.service.label=${serviceLabel}\"\n    }\n\n    println \"${index}##${displayName}##${description}####${props}\"\n}\n\nreturn 0"
        },
        "filters": []
    },
    "dataPoints": [
        {
            "id": 24410,
            "dataSourceId": 21328172,
            "name": "RxOpticalPower",
            "description": "Received optical power in dBm",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "RxOpticalPower",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "sQ_GVWxHSqGcvV7yoix3tA",
            "statusDisplayNames": []
        },
        {
            "id": 24411,
            "dataSourceId": 21328172,
            "name": "TxOpticalPower",
            "description": "Transmitted optical power in dBm",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "TxOpticalPower",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "dpV4rGL7QXaDLG0smy7eGw",
            "statusDisplayNames": []
        },
        {
            "id": 24412,
            "dataSourceId": 21328172,
            "name": "AdminStatus",
            "description": "Admin status: 1=up, 2=down, 3=upNoAlm",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "AdminStatus",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "0aXWTuCYR6SCfa_OOvWRtg",
            "statusDisplayNames": []
        },
        {
            "id": 24413,
            "dataSourceId": 21328172,
            "name": "OperStatus",
            "description": "Operational status: 1=up, 2=down",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "OperStatus",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "XytJesx7QtyR7YOMhTFTDQ",
            "statusDisplayNames": []
        },
        {
            "id": 24414,
            "dataSourceId": 21328172,
            "name": "OSNR",
            "description": "Optical Signal-to-Noise Ratio in dB. Values below 21 indicate degraded signal.",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "OSNR",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "< 21",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "xEY2bk_JQfaSfs_6ICX1zg",
            "statusDisplayNames": []
        },
        {
            "id": 24415,
            "dataSourceId": 21328172,
            "name": "QFactor",
            "description": "Q-Factor for signal quality. Normal range 7-35.",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "QFactor",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "shrLjrLRRryQHMUxxboe6A",
            "statusDisplayNames": []
        },
        {
            "id": 24416,
            "dataSourceId": 21328172,
            "name": "PreFecBer",
            "description": "Pre-FEC Bit Error Rate. Values above 0.05 indicate critical signal degradation.",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "PreFecBer",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "> 0.05",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "yr45xaPuSem2Eg4YjtIIwQ",
            "statusDisplayNames": []
        },
        {
            "id": 24417,
            "dataSourceId": 21328172,
            "name": "PostFecBer",
            "description": "Post-FEC Bit Error Rate. Any value above 0 indicates uncorrectable errors.",
            "alertTransitionInterval": 5,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "PostFecBer",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "> 0",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "AMxh_qqpT8mai6Sva8z3BA",
            "statusDisplayNames": []
        }
    ],
    "enableEriDiscovery": false,
    "eriDiscoveryInterval": -1,
    "eriDiscoveryConfig": null
}
