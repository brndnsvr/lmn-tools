{
  "_version": "2.0.1",
  "_changelog": "v2.0.1: Removed maxValue constraint on FIBUtilization",
  "name": "Juniper_RoutingTable",
  "displayName": "Routing Table",
  "description": "Monitors routing table size and FIB utilization on Juniper routers and firewalls for capacity planning and anomaly detection.",
  "appliesTo": "hasCategory(\"Juniper\")",
  "technology": "Uses standard IP-FORWARD-MIB (inetCidrRouteNumber) and Juniper MIBs for route counting. Works on all Juniper platforms including SRX.",
  "tags": "juniper,routing,bgp,ospf,capacity,network",
  "group": "",
  "hasMultiInstances": false,
  "useWildValueAsUUID": false,
  "collectInterval": 300,
  "collectMethod": "script",
  "collectorAttribute": {
    "name": "script",
    "groovyScript": "// Routing Table Monitoring via IP-FORWARD-MIB\n// v2.0.1: Removed FIBUtilization maxValue constraint\nimport com.santaba.agent.groovyapi.snmp.Snmp\n\ndef hostname = hostProps.get('system.hostname')\ndef ipCidrRouteNumberOid = '1.3.6.1.2.1.4.24.6.0'\n\ndef totalRoutes = 0\ndef activeRoutes = 0\ndef hiddenRoutes = 0\n\ntry {\n    // Use 2-arg signature - LM handles SNMP credentials from device config\n    def routeCount = Snmp.get(hostname, ipCidrRouteNumberOid)\n    \n    if (routeCount && routeCount != 'noSuchObject' && routeCount != 'noSuchInstance') {\n        totalRoutes = routeCount.toString().toInteger()\n        activeRoutes = totalRoutes\n        hiddenRoutes = 0\n    }\n    \n    def fibLimit = hostProps.get('routing.fib.limit')?.toInteger() ?: 256000\n    def fibUtil = fibLimit > 0 ? ((totalRoutes / fibLimit) * 100).round(2) : 0\n    \n    println \"TotalRoutes=${totalRoutes}\"\n    println \"ActiveRoutes=${activeRoutes}\"\n    println \"HiddenRoutes=${hiddenRoutes}\"\n    println \"FIBUtilization=${fibUtil}\"\n    \n} catch (Exception e) {\n    println \"Error: ${e.class.simpleName} - ${e.message}\"\n}\n\nreturn 0",
    "scriptType": "embed",
    "linuxCmdline": "",
    "linuxScript": "",
    "windowsCmdline": "",
    "windowsScript": ""
  },
  "enableAutoDiscovery": false,
  "dataPoints": [
    {
      "name": "TotalRoutes",
      "description": "Total routes in the routing table",
      "alertTransitionInterval": 0,
      "alertClearTransitionInterval": 0,
      "type": 2,
      "dataType": 7,
      "maxDigits": 4,
      "postProcessorMethod": "namevalue",
      "postProcessorParam": "TotalRoutes",
      "rawDataFieldName": "output",
      "maxValue": "",
      "minValue": "",
      "userParam1": "",
      "userParam2": "",
      "userParam3": "",
      "alertForNoData": 1,
      "alertExpr": "",
      "alertExprNote": "",
      "alertSubject": "",
      "alertBody": ""
    },
    {
      "name": "ActiveRoutes",
      "description": "Active routes in the routing table",
      "alertTransitionInterval": 0,
      "alertClearTransitionInterval": 0,
      "type": 2,
      "dataType": 7,
      "maxDigits": 4,
      "postProcessorMethod": "namevalue",
      "postProcessorParam": "ActiveRoutes",
      "rawDataFieldName": "output",
      "maxValue": "",
      "minValue": "",
      "userParam1": "",
      "userParam2": "",
      "userParam3": "",
      "alertForNoData": 1,
      "alertExpr": "",
      "alertExprNote": "",
      "alertSubject": "",
      "alertBody": ""
    },
    {
      "name": "HiddenRoutes",
      "description": "Hidden (inactive) routes",
      "alertTransitionInterval": 0,
      "alertClearTransitionInterval": 0,
      "type": 2,
      "dataType": 7,
      "maxDigits": 4,
      "postProcessorMethod": "namevalue",
      "postProcessorParam": "HiddenRoutes",
      "rawDataFieldName": "output",
      "maxValue": "",
      "minValue": "",
      "userParam1": "",
      "userParam2": "",
      "userParam3": "",
      "alertForNoData": 1,
      "alertExpr": "> 100",
      "alertExprNote": "High hidden route count",
      "alertSubject": "",
      "alertBody": ""
    },
    {
      "name": "FIBUtilization",
      "description": "FIB table utilization percentage",
      "alertTransitionInterval": 0,
      "alertClearTransitionInterval": 0,
      "type": 2,
      "dataType": 7,
      "maxDigits": 4,
      "postProcessorMethod": "namevalue",
      "postProcessorParam": "FIBUtilization",
      "rawDataFieldName": "output",
      "maxValue": "",
      "minValue": "0",
      "userParam1": "",
      "userParam2": "",
      "userParam3": "",
      "alertForNoData": 1,
      "alertExpr": "> 80 90",
      "alertExprNote": "FIB utilization high",
      "alertSubject": "",
      "alertBody": ""
    }
  ],
  "graphs": [
    {
      "name": "Route Counts",
      "title": "Route Counts",
      "verticalLabel": "Routes",
      "rigid": false,
      "maxValue": "NaN",
      "minValue": "0",
      "displayPrio": 1,
      "timescale": "1day",
      "base1024": false,
      "dataPoints": [
        {
          "name": "TotalRoutes",
          "consolidateFunc": 1,
          "aggregateMethod": "sum",
          "aggregateFunc": "sum"
        },
        {
          "name": "ActiveRoutes",
          "consolidateFunc": 1,
          "aggregateMethod": "sum",
          "aggregateFunc": "sum"
        }
      ]
    },
    {
      "name": "Active vs Hidden",
      "title": "Active vs Hidden Routes",
      "verticalLabel": "Routes",
      "rigid": false,
      "maxValue": "NaN",
      "minValue": "0",
      "displayPrio": 2,
      "timescale": "1day",
      "base1024": false,
      "dataPoints": [
        {
          "name": "ActiveRoutes",
          "consolidateFunc": 1,
          "aggregateMethod": "sum",
          "aggregateFunc": "sum"
        },
        {
          "name": "HiddenRoutes",
          "consolidateFunc": 1,
          "aggregateMethod": "sum",
          "aggregateFunc": "sum"
        }
      ]
    },
    {
      "name": "FIB Utilization",
      "title": "FIB Utilization",
      "verticalLabel": "%",
      "rigid": false,
      "maxValue": "NaN",
      "minValue": "0",
      "displayPrio": 3,
      "timescale": "1day",
      "base1024": false,
      "dataPoints": [
        {
          "name": "FIBUtilization",
          "consolidateFunc": 1,
          "aggregateMethod": "max",
          "aggregateFunc": "max"
        }
      ]
    }
  ]
}
