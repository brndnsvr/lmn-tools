{
  "name": "Juniper_RoutingTable_Debug",
  "displayName": "Routing Table Debug",
  "description": "Debug version - tests SNMP connectivity",
  "appliesTo": "false()",
  "technology": "Debug DataSource",
  "tags": "debug",
  "group": "",
  "hasMultiInstances": false,
  "useWildValueAsUUID": false,
  "collectInterval": 60,
  "collectMethod": "batchscript",
  "collectorAttribute": {
    "name": "batchscript",
    "groovyScript": "// Debug Script - Test SNMP connectivity\nimport com.santaba.agent.groovyapi.snmp.Snmp\n\ndef hostname = hostProps.get('system.hostname')\ndef timeout = 10000\ndef snmpVersion = hostProps.get('snmp.version') ?: 'v2c'\ndef community = hostProps.get('snmp.community') ?: 'public'\n\nprintln \"DEBUG: hostname=${hostname}\"\nprintln \"DEBUG: snmpVersion=${snmpVersion}\"\n\n// Build SNMPv3 params if needed\ndef snmpV3Params = null\ndef isV3 = (snmpVersion == 'v3' || snmpVersion == '3')\nif (isV3) {\n    snmpV3Params = [\n        version: 3,\n        port: hostProps.get('snmp.port')?.toInteger() ?: 161,\n        timeout: timeout,\n        securityName: hostProps.get('snmp.security'),\n        authProtocol: hostProps.get('snmp.auth'),\n        authPassword: hostProps.get('snmp.authToken'),\n        privProtocol: hostProps.get('snmp.priv'),\n        privPassword: hostProps.get('snmp.privToken')\n    ]\n    println \"DEBUG: Using SNMPv3 params: securityName=${snmpV3Params.securityName}, authProtocol=${snmpV3Params.authProtocol}\"\n} else {\n    println \"DEBUG: Using SNMPv2c community=${community?.substring(0,3)}***\"\n}\n\n// Test with sysDescr OID (should work on any SNMP device)\ndef sysDescrOid = '1.3.6.1.2.1.1.1.0'\n\ntry {\n    def result\n    // v2c signature: get(hostname, oid, community, version, timeout)\n    // v3 signature: get(hostname, oid, map, timeout)\n    if (isV3) {\n        result = Snmp.get(hostname, sysDescrOid, snmpV3Params, timeout)\n    } else {\n        result = Snmp.get(hostname, sysDescrOid, community, snmpVersion, timeout)\n    }\n    \n    println \"DEBUG: sysDescr result = ${result}\"\n    \n    if (result && result != 'noSuchInstance') {\n        println \"TestValue=1\"\n        println \"DEBUG: SNMP working!\"\n    } else {\n        println \"TestValue=0\"\n        println \"DEBUG: SNMP returned null or noSuchInstance\"\n    }\n} catch (Exception e) {\n    println \"TestValue=0\"\n    println \"DEBUG: Exception: ${e.class.name}: ${e.message}\"\n    e.printStackTrace()\n}\n\nreturn 0",
    "scriptType": "embed",
    "linuxCmdline": "",
    "linuxScript": "",
    "windowsCmdline": "",
    "windowsScript": ""
  },
  "enableAutoDiscovery": false,
  "dataPoints": [
    {
      "name": "TestValue",
      "description": "1 if SNMP works, 0 if not",
      "alertTransitionInterval": 0,
      "alertClearTransitionInterval": 0,
      "type": 2,
      "dataType": 7,
      "maxDigits": 4,
      "postProcessorMethod": "namevalue",
      "postProcessorParam": "TestValue",
      "rawDataFieldName": "output",
      "maxValue": "",
      "minValue": "",
      "userParam1": "",
      "userParam2": "",
      "userParam3": "",
      "alertForNoData": 1,
      "alertExpr": "",
      "alertExprNote": "",
      "alertSubject": "",
      "alertBody": ""
    }
  ]
}
