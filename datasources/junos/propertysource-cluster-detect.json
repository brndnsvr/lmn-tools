{
  "name": "Juniper_SRX_ClusterDetect",
  "displayName": "Juniper SRX Cluster Detection",
  "description": "Automatically detects if an SRX firewall is operating in chassis cluster mode and sets the auto.cluster_mode property.",
  "appliesTo": "system.categories =~ \"Juniper\" && system.sysinfo =~ \"SRX\"",
  "technology": "Sets auto.cluster_mode=true if cluster is detected, enabling the Juniper_SRX_ChassisCluster datasource. Uses SNMP to query jnxJsChassisClusterSwitchoverCount.",
  "tags": "juniper,srx,propertysource,auto-discovery",
  "group": "Juniper",
  "interval": 86400,
  "scriptType": "embed",
  "groovyScript": "// Groovy PropertySource Script for SRX Cluster Detection\nimport com.santaba.agent.groovyapi.snmp.Snmp\n\ndef host = hostProps.get('system.hostname')\ndef timeout = 10000\ndef port = hostProps.get('snmp.port')?.toInteger() ?: 161\n\n// Build SNMP parameters\ndef snmpVersion = hostProps.get('snmp.version') ?: '2c'\ndef snmpParams\nif (snmpVersion == 'v3' || snmpVersion == '3') {\n    snmpParams = [\n        version: 3,\n        port: port,\n        timeout: timeout,\n        securityName: hostProps.get('snmp.security'),\n        authProtocol: hostProps.get('snmp.auth'),\n        authPassword: hostProps.get('snmp.authToken'),\n        privProtocol: hostProps.get('snmp.priv'),\n        privPassword: hostProps.get('snmp.privToken')\n    ]\n} else {\n    snmpParams = [\n        version: snmpVersion,\n        port: port,\n        timeout: timeout,\n        community: hostProps.get('snmp.community') ?: 'public'\n    ]\n}\n\n// Check for cluster MIB existence\n// jnxJsChassisClusterSwitchoverCount: 1.3.6.1.4.1.2636.3.39.1.13.1.1.1.8.0\ndef clusterOid = '1.3.6.1.4.1.2636.3.39.1.13.1.1.1.8.0'\n\ntry {\n    def result = Snmp.get(host, clusterOid, snmpParams)\n    \n    if (result != null && result != 'noSuchInstance' && result != 'noSuchObject') {\n        // Cluster is enabled\n        println 'auto.cluster_mode=true'\n        \n        // Try to get additional cluster info\n        def clusterIdOid = '1.3.6.1.4.1.2636.3.39.1.13.1.1.1.1.0'\n        def nodeIdOid = '1.3.6.1.4.1.2636.3.39.1.13.1.1.1.3.0'\n        \n        def clusterId = Snmp.get(host, clusterIdOid, snmpParams)\n        def nodeId = Snmp.get(host, nodeIdOid, snmpParams)\n        \n        if (clusterId) println \"auto.cluster_id=${clusterId}\"\n        if (nodeId) println \"auto.cluster_node_id=${nodeId}\"\n        \n    } else {\n        // Standalone mode\n        println 'auto.cluster_mode=false'\n    }\n} catch (Exception e) {\n    // SNMP error - assume standalone\n    println 'auto.cluster_mode=false'\n}\n\nreturn 0"
}
