{
    "id": 21328171,
    "description": "Monitors Infinera Groove port optical power, status, and throughput",
    "group": "SNMP",
    "appliesTo": "hasCategory(\"InfineraGroove\")",
    "technology": "",
    "tags": "optical",
    "accessGroupIds": [
        1
    ],
    "accessGroups": [
        {
            "id": 1,
            "name": "Default Access Group",
            "createdOn": 1710215006000,
            "updatedOn": 1710215006000,
            "createdBy": "auto",
            "description": "A default access group",
            "tenantId": null
        }
    ],
    "checksum": "177985e209b946fab711ccaa44587bb8",
    "lineageId": "zwazBsqtRu-cGEXLi6D89A",
    "installationMetadata": {
        "originRegistryId": null,
        "originLineageId": null,
        "originAuthorCompanyUUID": null,
        "originAuthorNamespace": null,
        "originVersion": null,
        "originName": null,
        "originLocator": null,
        "originChecksum": null,
        "auditedRegistryId": null,
        "auditedVersion": null,
        "targetLineageId": "zwazBsqtRu-cGEXLi6D89A",
        "targetLastPublishedId": "d4becae4-8f19-4b16-858d-8407d4761a14",
        "targetLastPublishedVersion": "1.6.0",
        "targetLastPublishedChecksum": "abd3e3f9f41277271d9cba128a0818f6",
        "logicModuleType": "DATASOURCE",
        "localModuleId": 21328171,
        "isChangedFromOrigin": false,
        "isChangedFromTargetLastPublished": true
    },
    "name": "Infinera_Port_Status",
    "displayName": "Client Port Health",
    "version": 1765428491,
    "auditVersion": 0,
    "payloadVersion": 0,
    "hasMultiInstances": true,
    "useWildValueAsUUID": false,
    "collectInterval": 120,
    "collectMethod": "script",
    "collectorAttribute": {
        "name": "script",
        "linuxCmdline": "",
        "linuxScript": "",
        "groovyScript": "import com.santaba.agent.groovyapi.snmp.Snmp\n\ndef host = hostProps.get(\"system.hostname\")\ndef wildvalue = instanceProps.get(\"wildvalue\")\ndef instanceType = instanceProps.get(\"auto.instance.type\") ?: \"port\"\n\ndef portBase = \"1.3.6.1.4.1.42229.1.2.3.6.1.1\"\ndef subportBase = \"1.3.6.1.4.1.42229.1.2.3.7.1.1\"\n\ndef rxPowerOid, txPowerOid, adminStatusOid, operStatusOid\n\nif (instanceType == \"subport\") {\n    rxPowerOid = \"${subportBase}.16.${wildvalue}\"\n    txPowerOid = \"${subportBase}.17.${wildvalue}\"\n    adminStatusOid = \"${subportBase}.5.${wildvalue}\"\n    operStatusOid = \"${subportBase}.6.${wildvalue}\"\n} else {\n    rxPowerOid = \"${portBase}.4.${wildvalue}\"\n    txPowerOid = \"${portBase}.5.${wildvalue}\"\n    adminStatusOid = \"${portBase}.19.${wildvalue}\"\n    operStatusOid = \"${portBase}.20.${wildvalue}\"\n}\n\ndef rxPower = \"NaN\"\ndef txPower = \"NaN\"\ndef adminStatus = \"NaN\"\ndef operStatus = \"NaN\"\n\ntry {\n    def rxResult = Snmp.get(host, rxPowerOid)\n    if (rxResult != null && rxResult != \"\") {\n        rxPower = rxResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def txResult = Snmp.get(host, txPowerOid)\n    if (txResult != null && txResult != \"\") {\n        txPower = txResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def adminResult = Snmp.get(host, adminStatusOid)\n    if (adminResult != null && adminResult != \"\") {\n        adminStatus = adminResult.toString()\n    }\n} catch (Exception e) {}\n\ntry {\n    def operResult = Snmp.get(host, operStatusOid)\n    if (operResult != null && operResult != \"\") {\n        operStatus = operResult.toString()\n    }\n} catch (Exception e) {}\n\nprintln \"RxOpticalPower=${rxPower}\"\nprintln \"TxOpticalPower=${txPower}\"\nprintln \"AdminStatus=${adminStatus}\"\nprintln \"OperStatus=${operStatus}\"\n\nreturn 0",
        "scriptType": "embed",
        "windowsCmdline": "",
        "windowsScript": "",
        "properties": "",
        "manualConnections": ""
    },
    "enableAutoDiscovery": true,
    "autoDiscoveryConfig": {
        "persistentInstance": false,
        "disableInstance": false,
        "deleteInactiveInstance": true,
        "showDeletedInstanceDays": 0,
        "instanceAutoGroupMethod": "none",
        "instanceAutoGroupMethodParams": "",
        "scheduleInterval": 15,
        "method": {
            "name": "ad_script",
            "type": "embeded",
            "winScript": null,
            "winCmdline": null,
            "linuxCmdline": null,
            "linuxScript": null,
            "groovyScript": "import com.santaba.agent.groovyapi.snmp.Snmp\n\ndef host = hostProps.get(\"system.hostname\")\n\n// Port table OIDs\ndef portNameOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.16\"\ndef portTypeOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.17\"\ndef portModeOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.18\"\ndef portServiceLabelOid = \"1.3.6.1.4.1.42229.1.2.3.6.1.1.23\"\n\n// Subport table OIDs\ndef subportIdOid = \"1.3.6.1.4.1.42229.1.2.3.7.1.1.1\"\ndef subportNameOid = \"1.3.6.1.4.1.42229.1.2.3.7.1.1.2\"\ndef subportTypeOid = \"1.3.6.1.4.1.42229.1.2.3.7.1.1.3\"\ndef subportModeOid = \"1.3.6.1.4.1.42229.1.2.3.7.1.1.4\"\ndef subportServiceLabelOid = \"1.3.6.1.4.1.42229.1.2.3.7.1.1.9\"\n\n// Port type mapping\ndef portTypeMap = [1:\"client\", 2:\"line\", 3:\"client-subport\", 4:\"optical\", 5:\"otdr\", 6:\"optical-nomon\", 7:\"ocm\", 8:\"osc\", 9:\"mgmt-eth\"]\n\n// Port mode to speed (bps) mapping\ndef portModeSpeedMap = [\n    0: 0,\n    1: 10000000000,\n    2: 40000000000,\n    3: 100000000000,\n    4: 40000000000,\n    5: 100000000000,\n    6: 300000000000,\n    7: 200000000000,\n    8: 16000000000,\n    9: 8000000000,\n    10: 112000000000,\n    22: 400000000000,\n    45: 1000000000\n]\n\ndef portModeNameMap = [\n    0: \"N/A\", 1: \"10GbE\", 2: \"40GbE\", 3: \"100GbE\", 4: \"4x10G\", \n    5: \"100G-QPSK\", 6: \"300G-8QAM\", 7: \"200G-16QAM\", 8: \"16G-FC\", \n    9: \"8G-FC\", 10: \"OTU4\", 22: \"400GbE\", 45: \"1GbE\"\n]\n\ndef portNameData, portTypeData, portModeData, portServiceLabelData\ndef subportIdData, subportNameData, subportTypeData, subportModeData, subportServiceLabelData\n\ntry {\n    portNameData = Snmp.walkAsMap(host, portNameOid, null)\n    portTypeData = Snmp.walkAsMap(host, portTypeOid, null)\n    portModeData = Snmp.walkAsMap(host, portModeOid, null)\n    portServiceLabelData = Snmp.walkAsMap(host, portServiceLabelOid, null)\n    \n    subportIdData = Snmp.walkAsMap(host, subportIdOid, null)\n    subportNameData = Snmp.walkAsMap(host, subportNameOid, null)\n    subportTypeData = Snmp.walkAsMap(host, subportTypeOid, null)\n    subportModeData = Snmp.walkAsMap(host, subportModeOid, null)\n    subportServiceLabelData = Snmp.walkAsMap(host, subportServiceLabelOid, null)\n} catch (Exception e) {\n    println \"SNMP walk failed: ${e.message}\"\n    return 1\n}\n\nif (portNameData && !portNameData.isEmpty()) {\n    portNameData.each { index, portName ->\n        def parts = index.split(\"\\\\.\")\n        if (parts.size() < 4) return\n        \n        def shelf = parts[0]\n        def slot = parts[1]\n        def subslot = parts[2]\n        def port = parts[3]\n        \n        if (shelf == \"99\" || slot == \"99\") return\n        \n        def portTypeCode = portTypeData.get(index)?.toString() ?: \"\"\n        def portType = \"\"\n        try {\n            portType = portTypeMap.get(portTypeCode.toInteger()) ?: \"\"\n        \n        // Skip line ports - they're handled by Line Port Health DataSource\n        if (portType == \"line\") return\n        } catch (Exception e) {}\n        \n        def portModeCode = portModeData.get(index)?.toString() ?: \"0\"\n        def portModeInt = 0\n        try {\n            portModeInt = portModeCode.toInteger()\n        } catch (Exception e) {}\n        \n        def speedBps = portModeSpeedMap.get(portModeInt) ?: 0\n        def modeName = portModeNameMap.get(portModeInt) ?: \"Unknown\"\n        \n        def serviceLabel = portServiceLabelData.get(index)?.toString()?.trim() ?: \"\"\n        \n        def portPath\n        if (subslot == \"0\") {\n            portPath = \"${shelf}/${slot}/${port}\"\n        } else {\n            portPath = \"${shelf}/${slot}.${subslot}/${port}\"\n        }\n        \n        def displayName = portType ? \"${portPath} [${portType}]\" : portPath\n        def description = portName?.toString()?.trim() ?: \"\"\n        \n        def props = \"auto.port.speed=${speedBps}\"\n        props += \"&auto.port.mode=${modeName}\"\n        props += \"&auto.port.type=${portType}\"\n        if (serviceLabel) {\n            props += \"&auto.service.label=${serviceLabel}\"\n        }\n        props += \"&auto.instance.type=port\"\n        \n        println \"${index}##${displayName}##${description}####${props}\"\n    }\n}\n\nif (subportIdData && !subportIdData.isEmpty()) {\n    subportIdData.each { index, subportId ->\n        def parts = index.split(\"\\\\.\")\n        if (parts.size() < 5) return\n        \n        def shelf = parts[0]\n        def slot = parts[1]\n        def subslot = parts[2]\n        def port = parts[3]\n        def subport = parts[4]\n        \n        if (shelf == \"99\" || slot == \"99\") return\n        \n        def subportTypeCode = subportTypeData.get(index)?.toString() ?: \"\"\n        def subportType = \"\"\n        try {\n            subportType = portTypeMap.get(subportTypeCode.toInteger()) ?: \"client-subport\"\n        } catch (Exception e) {\n            subportType = \"client-subport\"\n        }\n        \n        def speedBps = 10000000000\n        def modeName = \"10GbE\"\n        \n        def serviceLabel = subportServiceLabelData.get(index)?.toString()?.trim() ?: \"\"\n        def subportName = subportNameData.get(index)?.toString()?.trim() ?: \"\"\n        \n        def portPath\n        if (subslot == \"0\") {\n            portPath = \"${shelf}/${slot}/${port}/${subport}\"\n        } else {\n            portPath = \"${shelf}/${slot}.${subslot}/${port}/${subport}\"\n        }\n        \n        def displayName = \"${portPath} [${subportType}]\"\n        def description = subportName ?: \"\"\n        \n        def props = \"auto.port.speed=${speedBps}\"\n        props += \"&auto.port.mode=${modeName}\"\n        props += \"&auto.port.type=${subportType}\"\n        if (serviceLabel) {\n            props += \"&auto.service.label=${serviceLabel}\"\n        }\n        props += \"&auto.instance.type=subport\"\n        \n        println \"${index}##${displayName}##${description}####${props}\"\n    }\n}\n\nreturn 0"
        },
        "filters": []
    },
    "dataPoints": [
        {
            "id": 24361,
            "dataSourceId": 21328171,
            "name": "RxOpticalPower",
            "description": "RxOpticalPower",
            "alertTransitionInterval": 0,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "RxOpticalPower",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "< -10",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": null,
            "statusDisplayNames": []
        },
        {
            "id": 24362,
            "dataSourceId": 21328171,
            "name": "TxOpticalPower",
            "description": "TxOpticalPower",
            "alertTransitionInterval": 0,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "TxOpticalPower",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "p4-5NtTdQ2K9IO5uJTyw4w",
            "statusDisplayNames": []
        },
        {
            "id": 24363,
            "dataSourceId": 21328171,
            "name": "AdminStatus",
            "description": "AdminStatus",
            "alertTransitionInterval": 0,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "AdminStatus",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "I4ijoPujTPCpu0e4pAhR_w",
            "statusDisplayNames": []
        },
        {
            "id": 24364,
            "dataSourceId": 21328171,
            "name": "OperStatus",
            "description": "OperStatus",
            "alertTransitionInterval": 0,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "namevalue",
            "postProcessorParam": "OperStatus",
            "rawDataFieldName": "output",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "_RDvdxXTS3am8zaThCi4GQ",
            "statusDisplayNames": []
        },
        {
            "id": 24409,
            "dataSourceId": 21328171,
            "name": "RxOpticalPowerAlert",
            "description": "Rx power for alerting (NaN when admin-down)",
            "alertTransitionInterval": 0,
            "alertClearTransitionInterval": 0,
            "type": 2,
            "dataType": 7,
            "maxDigits": 4,
            "postProcessorMethod": "expression",
            "postProcessorParam": "AdminStatus,1,EQ,RxOpticalPower,100,IF",
            "rawDataFieldName": "",
            "maxValue": "",
            "minValue": "",
            "userParam1": "",
            "userParam2": "",
            "userParam3": "",
            "alertForNoData": 1,
            "alertExpr": "",
            "alertExprNote": "",
            "alertSubject": "",
            "alertBody": "",
            "enableAnomalyAlertSuppression": "",
            "adAdvSettingEnabled": false,
            "warnAdAdvSetting": "",
            "errorAdAdvSetting": "",
            "criticalAdAdvSetting": "",
            "originId": "vDpW9KTKQNChSK1Z_YCuEQ",
            "statusDisplayNames": []
        }
    ],
    "enableEriDiscovery": false,
    "eriDiscoveryInterval": -1,
    "eriDiscoveryConfig": null
}
